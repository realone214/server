{"ast":null,"code":"import React,{useEffect,useState,useRef}from\"react\";import\"./App.css\";import{jsxs as _jsxs,jsx as _jsx,Fragment as _Fragment}from\"react/jsx-runtime\";const Chat=_ref=>{let{socket,room,userName}=_ref;const[currentMessage,setCurrentMessage]=useState(\"\");const[messageList,setMessageList]=useState([]);const[activeUsers,setActiveUsers]=useState([]);const receiveMessageHandler=data=>{console.log('Received message:',data);if(data.author!==userName){setMessageList(list=>[...list,data]);}};const activeUsersHandler=users=>{console.log('Active users:',users);setActiveUsers(users);};const allMessagesHandler=messages=>{console.log('All messages:',messages);setMessageList(messages);};useEffect(()=>{console.log('useEffect is running with socket, room, userName:',socket,room,userName);socket.on('receive_message',receiveMessageHandler);socket.on('active_users',activeUsersHandler);socket.on('all_messages',allMessagesHandler);socket.emit('join_room',{room,userName});return()=>{console.log('Component is unmounting, leaving room:',room,userName);socket.emit('leave_room',{room,userName});socket.off('receive_message',receiveMessageHandler);socket.off('active_users',activeUsersHandler);socket.off('all_messages',allMessagesHandler);};},[socket,room,userName]);const sendMessage=async()=>{if(currentMessage!==\"\"){const messageData={room:room,author:userName,message:currentMessage,time:new Date().toLocaleString()};console.log('Sending message:',messageData);await socket.emit('send_message',messageData);setMessageList(list=>[...list,messageData]);setCurrentMessage('');}};const messagesEndRef=useRef(null);const scrollToBottom=()=>{var _messagesEndRef$curre;(_messagesEndRef$curre=messagesEndRef.current)===null||_messagesEndRef$curre===void 0?void 0:_messagesEndRef$curre.scrollIntoView({behavior:\"smooth\"});};useEffect(()=>{scrollToBottom();},[messageList]);return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsxs(\"p\",{className:\"room-name\",children:[\"Hi \",userName,\", You are in room: \",room]}),/*#__PURE__*/_jsxs(\"div\",{className:\"active-users\",children:[/*#__PURE__*/_jsx(\"p\",{className:\"active-users-title\",children:\"Active Users:\"}),/*#__PURE__*/_jsx(\"div\",{className:\"active-users-list\",children:activeUsers.map((user,index)=>/*#__PURE__*/_jsx(\"button\",{children:user},index))})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"chat-container\",children:[messageList.map((messageContent,index)=>/*#__PURE__*/_jsxs(\"div\",{className:\"message\",id:userName===messageContent.author?'user-message':'other-message',children:[/*#__PURE__*/_jsx(\"p\",{className:\"author\",children:messageContent.author}),/*#__PURE__*/_jsxs(\"div\",{className:\"message-content\",children:[/*#__PURE__*/_jsx(\"p\",{className:\"message-text\",children:messageContent.message}),/*#__PURE__*/_jsx(\"p\",{className:\"time\",children:messageContent.time})]})]},index)),/*#__PURE__*/_jsx(\"div\",{ref:messagesEndRef}),/*#__PURE__*/_jsxs(\"div\",{className:\"message-input\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"text\",value:currentMessage,onChange:e=>setCurrentMessage(e.target.value),onKeyDown:e=>{e.key==='Enter'&&sendMessage();}}),/*#__PURE__*/_jsx(\"button\",{onClick:sendMessage,children:\"Send\"})]})]})]});};export default Chat;","map":{"version":3,"names":["React","useEffect","useState","useRef","jsxs","_jsxs","jsx","_jsx","Fragment","_Fragment","Chat","_ref","socket","room","userName","currentMessage","setCurrentMessage","messageList","setMessageList","activeUsers","setActiveUsers","receiveMessageHandler","data","console","log","author","list","activeUsersHandler","users","allMessagesHandler","messages","on","emit","off","sendMessage","messageData","message","time","Date","toLocaleString","messagesEndRef","scrollToBottom","_messagesEndRef$curre","current","scrollIntoView","behavior","children","className","map","user","index","messageContent","id","ref","type","value","onChange","e","target","onKeyDown","key","onClick"],"sources":["C:/Users/2022c/Desktop/realtime-chat-app/client/src/Chat.js"],"sourcesContent":["import React, { useEffect, useState, useRef } from \"react\";\r\nimport \"./App.css\";\r\n\r\nconst Chat = ({ socket, room, userName }) => {\r\n  const [currentMessage, setCurrentMessage] = useState(\"\");\r\n  const [messageList, setMessageList] = useState([]);\r\n  const [activeUsers, setActiveUsers] = useState([]);\r\n\r\n  const receiveMessageHandler = (data) => {\r\n    console.log('Received message:', data);\r\n    if(data.author !== userName){\r\n      setMessageList((list) => [...list, data]);\r\n    }\r\n  };\r\n\r\n  const activeUsersHandler = (users) => {\r\n    console.log('Active users:', users);\r\n    setActiveUsers(users);\r\n  };\r\n\r\n  const allMessagesHandler = (messages) => {\r\n    console.log('All messages:', messages);\r\n    setMessageList(messages);\r\n  };\r\n\r\n  useEffect(() => {\r\n\r\n    console.log('useEffect is running with socket, room, userName:', socket, room, userName);\r\n    socket.on('receive_message', receiveMessageHandler);\r\n    socket.on('active_users', activeUsersHandler);\r\n    socket.on('all_messages', allMessagesHandler);\r\n    socket.emit('join_room', { room, userName });\r\n\r\n    return () => {\r\n      console.log('Component is unmounting, leaving room:', room, userName);\r\n      socket.emit('leave_room', { room, userName });\r\n      socket.off('receive_message', receiveMessageHandler);\r\n      socket.off('active_users', activeUsersHandler);\r\n      socket.off('all_messages', allMessagesHandler);\r\n    };\r\n  },[socket, room, userName]);\r\n\r\n  const sendMessage = async () => {\r\n    if (currentMessage !== \"\") {\r\n      const messageData = {\r\n        room: room,\r\n        author: userName,\r\n        message: currentMessage,\r\n        time: new Date().toLocaleString()\r\n      };\r\n\r\n      console.log('Sending message:', messageData);\r\n      await socket.emit('send_message', messageData);\r\n      setMessageList((list) => [...list, messageData]);\r\n      setCurrentMessage('');\r\n    }\r\n  };\r\n\r\n  const messagesEndRef = useRef(null); \r\n  const scrollToBottom = () => { messagesEndRef.current?.scrollIntoView({ behavior: \"smooth\" }) }; \r\n  \r\n  useEffect(() => { \r\n    scrollToBottom() \r\n  }, [messageList]);\r\n\r\n  return (\r\n    <>\r\n      <div>\r\n        <p className='room-name'>Hi {userName}, You are in room: {room}</p>\r\n        <div className=\"active-users\"> \r\n          <p className='active-users-title'>Active Users:</p>\r\n          <div className='active-users-list'>\r\n            {activeUsers.map((user, index) => <button key={index}>{user}</button>)}\r\n          </div>\r\n        </div>\r\n      </div>\r\n      <div className='chat-container'>\r\n          {messageList.map((messageContent, index) => \r\n          <div className='message' id={userName === messageContent.author ? 'user-message' : 'other-message'} key={index}>\r\n            \r\n            <p className='author'>{messageContent.author}</p>\r\n            \r\n            <div className=\"message-content\">\r\n              <p className='message-text'>{messageContent.message}</p>\r\n              <p className='time'>{messageContent.time}</p>\r\n            </div>\r\n          </div>  \r\n        )}\r\n       \r\n       <div ref={messagesEndRef} />\r\n       \r\n        <div className='message-input'>\r\n          <input type=\"text\" value={currentMessage} onChange={(e) => setCurrentMessage(e.target.value)} \r\n            onKeyDown={(e) => {e.key === 'Enter' && sendMessage();}} \r\n          />\r\n          <button onClick={sendMessage}>Send</button>\r\n        </div>\r\n      </div>     \r\n    </>\r\n  );\r\n};\r\n\r\nexport default Chat;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}